10 REM PORT MONITOR - VIA PORT STATUS
20 PRINT "VIA2 PORT MONITOR (READ-ONLY)"
30 PRINT
40 REM PORT ADDRESSES
50 PA = 34817: REM VIA2 PORTA $8801
60 PB = 34816: REM VIA2 PORTB $8800
65 DA = 34819: REM VIA2 DDRA $8803
66 DB = 34818: REM VIA2 DDRB $8802
70 P = PB: REM DEFAULT TO PORTB
75 D = DB: REM DEFAULT DDR
80 REM MAIN MENU
90 PRINT "CURRENT PORT: ";
100 IF P = PA THEN PRINT "PORTA ($8801)"
110 IF P = PB THEN PRINT "PORTB ($8800)"
120 PRINT
130 GOSUB 2000: REM DISPLAY PORT
140 PRINT
150 PRINT "1. READ PORT"
160 PRINT "2. READ DDR"
170 PRINT "3. SWITCH PORT"
180 PRINT "4. MONITOR MODE"
190 PRINT "0. EXIT"
200 PRINT
210 INPUT "CHOICE"; C
220 IF C = 0 THEN PRINT "GOODBYE": END
230 IF C = 1 THEN GOSUB 1000
240 IF C = 2 THEN GOSUB 1900
250 IF C = 3 THEN GOSUB 1700
260 IF C = 4 THEN GOSUB 1500
270 GOTO 80
1000 REM READ PORT
1010 PRINT
1020 GOSUB 2000
1030 PRINT
1040 INPUT "PRESS ENTER"; A$
1050 RETURN
1100 REM WRITE PORT
1110 PRINT
1115 REM AUTO SET DDR TO OUTPUT
1117 POKE D, 255
1120 INPUT "VALUE (0-255)"; V
1130 IF V < 0 OR V > 255 THEN PRINT "INVALID": GOTO 1120
1140 POKE P, V
1150 PRINT "WRITTEN: "; V
1160 GOSUB 2000
1170 PRINT
1180 INPUT "PRESS ENTER"; A$
1190 RETURN
1200 REM SET BIT
1210 PRINT
1220 INPUT "BIT (0-7)"; B
1230 IF B < 0 OR B > 7 THEN PRINT "INVALID": GOTO 1220
1235 REM AUTO SET DDR BIT TO OUTPUT
1237 DV = PEEK(D)
1238 M = 2 ^ B
1239 POKE D, DV OR M
1240 V = PEEK(P)
1250 M = 2 ^ B
1260 V = V OR M
1270 POKE P, V
1280 PRINT "BIT "; B; " SET"
1290 GOSUB 2000
1295 PRINT
1297 INPUT "PRESS ENTER"; A$
1298 RETURN
1300 REM CLEAR BIT
1310 PRINT
1320 INPUT "BIT (0-7)"; B
1330 IF B < 0 OR B > 7 THEN PRINT "INVALID": GOTO 1320
1335 REM AUTO SET DDR BIT TO OUTPUT
1337 DV = PEEK(D)
1338 M = 2 ^ B
1339 POKE D, DV OR M
1340 V = PEEK(P)
1350 M = 2 ^ B
1360 M = 255 - M
1370 V = V AND M
1380 POKE P, V
1390 PRINT "BIT "; B; " CLEARED"
1395 GOSUB 2000
1397 PRINT
1398 INPUT "PRESS ENTER"; A$
1399 RETURN
1400 REM TOGGLE BIT
1410 PRINT
1420 INPUT "BIT (0-7)"; B
1430 IF B < 0 OR B > 7 THEN PRINT "INVALID": GOTO 1420
1435 REM AUTO SET DDR BIT TO OUTPUT
1437 DV = PEEK(D)
1438 M = 2 ^ B
1439 POKE D, DV OR M
1440 V = PEEK(P)
1450 M = 2 ^ B
1460 V = V XOR M
1470 POKE P, V
1480 PRINT "BIT "; B; " TOGGLED"
1490 GOSUB 2000
1495 PRINT
1497 INPUT "PRESS ENTER"; A$
1498 RETURN
1500 REM MONITOR MODE
1510 PRINT
1520 PRINT "MONITORING PORT"
1530 PRINT "ENTER LOOPS (1-1000)"
1540 INPUT "COUNT"; LC
1550 IF LC < 1 OR LC > 1000 THEN LC = 100
1560 PRINT
1570 FOR L = 1 TO LC
1580 GOSUB 2000
1590 FOR D = 1 TO 50: NEXT D
1600 NEXT L
1610 RETURN
1700 REM SWITCH PORT
1710 PRINT
1720 PRINT "CURRENT: ";
1730 IF P = PA THEN PRINT "PORTA"
1740 IF P = PB THEN PRINT "PORTB"
1750 PRINT
1760 PRINT "1. PORTA ($8801)"
1770 PRINT "2. PORTB ($8800)"
1780 INPUT "CHOICE"; C
1790 IF C = 1 THEN P = PA: D = DA
1800 IF C = 2 THEN P = PB: D = DB
1810 RETURN
1850 REM SET DDR OUTPUT
1860 PRINT
1870 PRINT "SET ALL BITS TO OUTPUT"
1880 POKE D, 255
1890 PRINT "DDR = $FF (ALL OUTPUT)"
1895 PRINT
1897 INPUT "PRESS ENTER"; A$
1898 RETURN
1900 REM READ DDR
1910 PRINT
1920 V = PEEK(D)
1930 PRINT "DDR VALUE: "; V; " = $";
1940 GOSUB 3000
1950 PRINT " = ";
1960 GOSUB 3100
1970 PRINT
1980 PRINT "(1=OUTPUT, 0=INPUT)"
1990 PRINT
1995 INPUT "PRESS ENTER"; A$
1996 RETURN
2000 REM DISPLAY PORT VALUE
2010 V = PEEK(P)
2020 PRINT "VALUE: "; V; " = $";
2030 GOSUB 3000: REM HEX
2040 PRINT " = ";
2050 GOSUB 3100: REM BINARY
2060 PRINT
2070 PRINT "BITS:  7 6 5 4 3 2 1 0"
2080 PRINT "       ";
2090 GOSUB 3100
2100 RETURN
3000 REM PRINT HEX
3010 H = INT(V / 16)
3020 IF H < 10 THEN PRINT CHR$(48 + H);
3030 IF H >= 10 THEN PRINT CHR$(55 + H);
3040 H = V - INT(V / 16) * 16
3050 IF H < 10 THEN PRINT CHR$(48 + H);
3060 IF H >= 10 THEN PRINT CHR$(55 + H);
3070 RETURN
3100 REM PRINT BINARY
3110 FOR I = 7 TO 0 STEP -1
3120 M = 2 ^ I
3130 IF V >= M THEN PRINT "1 ";: V = V - M: GOTO 3160
3150 PRINT "0 ";
3160 NEXT I
3170 V = PEEK(P): REM RESTORE V
3180 RETURN
