10 REM LCD CLOCK HH:MM:SS
20 PRINT "LCD CLOCK"
30 MC = 30000
40 REM LOAD LCD CLEAR CODE
50 FOR I = 0 TO 41
60 READ B
70 POKE MC + I, B
80 NEXT I
90 REM LOAD LCD PUTC CODE
100 FOR I = 0 TO 53
110 READ B
120 POKE MC + 42 + I, B
130 NEXT I
135 REM LOAD LCD CMD CODE
137 FOR I = 0 TO 49
138 READ B
139 POKE MC + 96 + I, B
140 NEXT I
150 PRINT "STARTING CLOCK"
160 GOSUB 1000
170 GOSUB 3500
180 H = 0: M = 0: S = 0
185 P1 = -1: P2 = -1: P3 = -1
190 REM MAIN LOOP
200 GOSUB 3000
210 FOR D = 1 TO 500
220 NEXT D
230 S = S + 1
240 IF S < 60 THEN GOTO 200
250 S = 0: M = M + 1
260 IF M < 60 THEN GOTO 200
270 M = 0: H = H + 1
280 IF H < 24 THEN GOTO 200
290 H = 0
300 GOTO 200
1000 REM LCD CLEAR
1010 POKE 10, 76
1020 POKE 11, MC AND 255
1030 POKE 12, MC / 256
1040 X = USR(0)
1050 RETURN
1100 REM LCD PUTC
1110 AD = MC + 42
1120 POKE 10, 76
1130 POKE 11, AD AND 255
1140 POKE 12, AD / 256
1150 X = USR(0)
1160 RETURN
1200 REM LCD CMD
1210 AD = MC + 96
1220 POKE 10, 76
1230 POKE 11, AD AND 255
1240 POKE 12, AD / 256
1250 X = USR(0)
1260 RETURN
2000 REM LCD CLEAR DATA
2010 REM HIGH NIBBLE 0 RS=0
2020 DATA 169,0,141,0,144
2030 REM E HIGH
2040 DATA 169,8,141,0,144
2050 REM SHORT DELAY
2060 DATA 234,234,234
2070 REM E LOW
2080 DATA 169,0,141,0,144
2090 REM LOW NIBBLE 1 RS=0
2100 DATA 169,16,141,0,144
2110 REM E HIGH
2120 DATA 169,24,141,0,144
2130 REM SHORT DELAY
2140 DATA 234,234,234
2150 REM E LOW
2160 DATA 169,16,141,0,144
2170 REM SHORT DELAY
2180 DATA 162,50,202,208,253
2190 DATA 96
2500 REM LCD PUTC DATA
2510 REM LOAD CHAR SAVE
2520 DATA 165,101,72
2530 REM HIGH NIBBLE KEEP 7-4
2540 DATA 41,240,9,2
2550 DATA 141,0,144
2560 REM E HIGH
2570 DATA 9,8,141,0,144
2580 REM DELAY
2590 DATA 234,234,234
2600 REM E LOW XOR
2610 DATA 73,8,141,0,144
2620 REM LOW NIBBLE RESTORE
2630 DATA 104,41,15,10
2640 DATA 10,10,10,9
2650 DATA 2,141,0,144
2660 REM E HIGH
2670 DATA 9,8,141,0,144
2680 REM DELAY
2690 DATA 234,234,234
2700 REM E LOW XOR
2710 DATA 73,8,141,0,144
2720 REM SHORT DELAY
2730 DATA 162,10,202,208,253
2740 DATA 96
3000 REM UPDATE TIME
3010 IF P1 = -1 THEN P1 = H: P2 = M: P3 = S: RETURN
3020 REM UPDATE HOURS
3030 IF H = P1 THEN GOTO 3120
3040 H1 = INT(H / 10)
3050 H2 = H - H1 * 10
3060 POKE 101, 128
3070 GOSUB 1200
3080 POKE 101, 48 + H1
3090 GOSUB 1100
3100 POKE 101, 48 + H2
3110 GOSUB 1100
3120 REM UPDATE MINUTES
3130 IF M = P2 THEN GOTO 3220
3140 M1 = INT(M / 10)
3150 M2 = M - M1 * 10
3160 POKE 101, 131
3170 GOSUB 1200
3180 POKE 101, 48 + M1
3190 GOSUB 1100
3200 POKE 101, 48 + M2
3210 GOSUB 1100
3220 REM UPDATE SECONDS
3230 IF S = P3 THEN GOTO 3330
3240 S1 = INT(S / 10)
3250 S2 = S - S1 * 10
3260 POKE 101, 134
3270 GOSUB 1200
3280 POKE 101, 48 + S1
3290 GOSUB 1100
3300 POKE 101, 48 + S2
3310 GOSUB 1100
3320 P1 = H: P2 = M: P3 = S
3330 RETURN
3500 REM INITIAL DISPLAY
3510 M$ = "00:00:00"
3520 FOR I = 1 TO LEN(M$)
3530 POKE 101, ASC(MID$(M$, I, 1))
3540 GOSUB 1100
3550 NEXT I
3560 RETURN
4000 REM LCD CMD DATA
4010 REM LOAD CMD SAVE
4020 DATA 165,101,72
4030 REM HIGH NIBBLE KEEP 7-4
4040 DATA 41,240,141,0,144
4050 REM E HIGH
4060 DATA 9,8,141,0,144
4070 REM DELAY
4080 DATA 234,234,234
4090 REM E LOW AND
4100 DATA 41,247,141,0,144
4110 REM LOW NIBBLE RESTORE
4120 DATA 104,41,15,10
4130 DATA 10,10,10,141
4140 DATA 0,144
4150 REM E HIGH
4160 DATA 9,8,141,0,144
4170 REM DELAY
4180 DATA 234,234,234
4190 REM E LOW AND
4200 DATA 41,247,141,0,144
4210 REM LONGER DELAY FOR COMMANDS
4220 DATA 162,50,202,208,253
4230 DATA 96
